<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="Generator" content="iWeb 3.0.4" />
    <meta name="iWeb-Build" content="local-build-20151213" />
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <meta name="viewport" content="width=700" />
    <title>Getting the best from your data</title>
    <link rel="stylesheet" type="text/css" media="screen,print" href="Best_practice_files/Best_practice.css" />
    <!--[if lt IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='Best_practice_files/Best_practiceIE.css'/><![endif]-->
    <!--[if gte IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='Media/IE8.css'/><![endif]-->
    <script type="text/javascript" src="Scripts/iWebSite.js"></script>
    <script type="text/javascript" src="Scripts/Widgets/SharedResources/WidgetCommon.js"></script>
    <script type="text/javascript" src="Scripts/Widgets/Navbar/navbar.js"></script>
    <script type="text/javascript" src="Best_practice_files/Best_practice.js"></script>
  </head>
  <body style="background: rgb(101, 101, 101); margin: 0pt; " onload="onPageLoad();" onunload="onPageUnload();">
    <div style="text-align: center; ">
      <div style="margin-bottom: 10px; margin-left: auto; margin-right: auto; margin-top: 10px; overflow: hidden; position: relative; word-wrap: break-word;  background: rgb(255, 255, 255); text-align: left; width: 700px; " id="body_content">
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 0; " id="nav_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div class="com-apple-iweb-widget-navbar flowDefining" id="widget0" style="margin-left: 20px; margin-top: 0px; opacity: 1.00; position: relative; width: 660px; z-index: 1; ">
    
            <div id="widget0-navbar" class="navbar">

      
              <div id="widget0-bg" class="navbar-bg">

        
                <ul id="widget0-navbar-list" class="navbar-list">
 <li></li> 
</ul>
                
      
</div>
              
    
</div>
          </div>
          <script type="text/javascript"><!--//--><![CDATA[//><!--
new NavBar('widget0', 'Scripts/Widgets/Navbar', 'Scripts/Widgets/SharedResources', '.', {"path-to-root": "", "navbar-css": ".navbar {\n\tfont-family: 'Helvetica Neue', Arial, sans-serif;\n\tfont-size: .8em;\n\tcolor: #666666;\n\tline-height: 30px;\n\tborder-bottom: 3px solid #ccc;\n}\n\n.navbar-bg {\n\ttext-align: right;}\n\n.navbar-bg ul {\n\tlist-style: none;\n\tmargin: 0px;\n\tpadding: 0px;\n}\n\n\nli {\n\tlist-style-type: none;\n\tdisplay: inline;\n\tpadding: 0px 5px 0px 0px;\n}\n\n\nli a {\n\ttext-decoration: none;\n\tpadding: 10px;\n\tcolor: #666666;\n\tfont-weight: bold;\n}\n\nli a:visited {\n\ttext-decoration: none;\n\tpadding: 10px;\n\tcolor: #666666;\n\tfont-weight: bold;\n}\n\nli a:hover\r{\r\n \tcolor: #999999;\n\ttext-decoration: none;\r}\n\n\nli.current-page a\r{\r\t color: #66ABC5;\n\ttext-decoration: none;\r}\n", "current-page-GUID": "CB6BAFEE-D19C-4EE4-A82F-ED3CFDBC483B", "isCollectionPage": "NO"});
//--><!]]></script>
          <div style="clear: both; height: 0px; line-height: 0px; " class="spacer"> </div>
        </div>
        <div style="height: 113px; margin-left: 0px; position: relative; width: 700px; z-index: 10; " id="header_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id1" style="height: 43px; left: 20px; position: absolute; top: 20px; width: 515px; z-index: 1; " class="style_SkipStroke shape-with-text">
            <div class="text-content Normal_External_515_43" style="padding: 0px; ">
              <div class="Normal">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Header">Getting the best from your data</p>
              </div>
            </div>
          </div>
          


          <div id="id2" style="height: 35px; left: 27px; position: absolute; top: 78px; width: 662px; z-index: 1; " class="style_SkipStroke_1 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_662_35" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Free_Form">A little effort goes a long way towards improving results.  Here are a few things that can make a difference.</p>
              </div>
            </div>
          </div>
        </div>
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 5; " id="body_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id3" style="height: 20px; left: 20px; position: absolute; top: 28px; width: 515px; z-index: 1; " class="style_SkipStroke_2 shape-with-text">
            <div class="text-content Normal_External_515_20" style="padding: 0px; ">
              <div class="Normal">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style">Update dark file</p>
              </div>
            </div>
          </div>
          


          <div id="id4" style="height: 64px; left: 27px; position: absolute; top: 50px; width: 662px; z-index: 1; " class="style_SkipStroke_1 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_662_64" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Free_Form">Detector offsets can change, especially when detector systems are swapped or per-pixel gain settings are adjusted.  It is good practice to use a new dark calibration for each new experiment.   The weaker your signals the more important this becomes - single photon signals are only a few detector values (ADU) in size and can get easily lost when using an old dark calibration file. </p>
              </div>
            </div>
          </div>
          


          <div id="id5" style="height: 20px; left: 20px; position: absolute; top: 125px; width: 515px; z-index: 1; " class="style_SkipStroke_2 shape-with-text">
            <div class="text-content Normal_External_515_20" style="padding: 0px; ">
              <div class="Normal">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style">Update bad pixel masks</p>
              </div>
            </div>
          </div>
          


          <div id="id6" style="height: 190px; left: 27px; position: absolute; top: 147px; width: 662px; z-index: 1; " class="style_SkipStroke_1 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_662_190" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-top: 0pt; " class="Free_Form">Every detector has bad pixels.  These need to be identified so that they can be avoided during analysis. <br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form">Bad pixels can be identified from dark frames as pixels that are either excessively noisy or have offsets significantly different to their neighbours.  Use darkcal.ini to process a dark run, then “Tools--&gt;Make bad pixel mask from Darkcal” to identify misbehaving pixels.<br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form">Dead pixels behave the same whether or not they are illuminated.  They are therefore useless for signal measurement, but can’t be identified from the dark calibration file because they look identical to normal pixels when not illuminated.  Dead pixels can be identified from runs in which photons are incident on each pixel (for example, water scattering).  Use brightfield.ini to sum up one such run, then “Tools--&gt; Make bad pixel mask from brightfield” to identify pixels which remain dark even when illuminated.<br /></p>
                <p class="Free_Form"><br /></p>
                <p style="padding-bottom: 0pt; " class="Free_Form">Masks can be combined using the “Tools--&gt;Combine masks” utility.  Use ‘Shift’ to select the masks to be combined.</p>
              </div>
            </div>
          </div>
          


          <div id="id7" style="height: 20px; left: 20px; position: absolute; top: 362px; width: 515px; z-index: 1; " class="style_SkipStroke_2 shape-with-text">
            <div class="text-content Normal_External_515_20" style="padding: 0px; ">
              <div class="Normal">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style">Update geometry</p>
              </div>
            </div>
          </div>
          


          <div id="id8" style="height: 120px; left: 27px; position: absolute; top: 384px; width: 662px; z-index: 1; " class="style_SkipStroke_1 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_662_120" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-top: 0pt; " class="Free_Form">Hit finding is normally not very sensitive to a perfect geometry, unlike crystal indexing, and Cheetah can happily run using the provided default geometry files.  Indeed this is often adequate.  However, radial background subtraction is sensitive to geometry, and can be quite so in the presence of concentric ‘powder rings’ from ice or other polycrystalline sample in the beam.  SAXS/WAXS traces also benefit from use of a refined geometry so that radial averages are averaged across the same scattering angles.<br /></p>
                <p class="Free_Form"><br /></p>
                <p style="padding-bottom: 0pt; " class="Free_Form">Accurate geometry files are best obtained using the results of crystal indexing.  Geometry refinement is extensively discussed on the <a title="http://www.desy.de/~twhite/crystfel/manual-geoptimiser.html" href="http://www.desy.de/~twhite/crystfel/manual-geoptimiser.html">CrystFEL web pages</a>. </p>
              </div>
            </div>
          </div>
          <div style="height: 504px; line-height: 504px; " class="spacer"> </div>
        </div>
        <div style="height: 605px; margin-left: 0px; position: relative; width: 700px; z-index: 15; " id="footer_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id9" style="height: 20px; left: 20px; position: absolute; top: 31px; width: 515px; z-index: 1; " class="style_SkipStroke_2 shape-with-text">
            <div class="text-content Normal_External_515_20" style="padding: 0px; ">
              <div class="Normal">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style">Optimising peak finding</p>
              </div>
            </div>
          </div>
          


          <div id="id10" style="height: 552px; left: 27px; position: absolute; top: 53px; width: 662px; z-index: 1; " class="style_SkipStroke_1 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_662_552" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-top: 0pt; " class="Free_Form">Cheetah is frequently used for hit finding crystal data.  Peakfinder8 is the most robust algorithm currently implemented for finding Bragg peaks.  Peakfinder8 uses radial average and standard deviation to dynamically set the threshold of what is called a peak, enabling detection of weak peaks at low-q without being overwhelmed by false peaks in the water ring. <br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form">The key parameters to change are:<br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMinSNR</span> (signal-to-noise required to count as a pixel that is a part of a peak)<br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMinPixCount</span> (number of connected pixels above hitfinderMinSNR required to constitute a peak)<br /></p>
                <p class="Free_Form">    <span class="style">hitfinderNpeaks</span> (number of peaks to count as a hit)<br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form">Less frequently adjusted but also useful are:<br /></p>
                <p class="Free_Form">    <span class="style">hitfinderADC</span> (minimum ADC value for the threshold, applied over the entire image) <br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMinRes</span> (inner radius of peak search, in pixels)<br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMaxRes</span> (outer radius of peak search, in pixels)<br /></p>
                <p class="Free_Form">    <span class="style">peakmask</span> (a user-defined pixel mask identifying regions of the image to exclude from peak searching)<br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form">The following are two good starting points which usually find something:<br /></p>
                <p class="Free_Form">For small, intense peaks that illuminate few pixels:<br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMinSNR=8</span><br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMinPixCount=2</span><br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form">For slightly larger, less intense peaks the following values typically work better<br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMinSNR=6</span><br /></p>
                <p class="Free_Form">    <span class="style">hitfinderMinPixCount=3<br /></span></p>
                <p class="Free_Form"><span class="style"><br /></span></p>
                <p class="Free_Form">Each sample is different, and there is no substitute for looking at the peak finding performance and adjusting values to suit your data.   Inspect hits found using the “View Hits” button, then select “Crystals--&gt;Default crystal display settings” to circle the peaks found by Cheetah.  This will immediately give some idea of whether many peaks are being missed, or whether most found peaks are in fact junk.  The definition of what constitutes a peak, where to search and number of peaks to count as a hit can be adjusted accordingly. <br /></p>
                <p class="Free_Form"><br /></p>
                <p class="Free_Form">A useful tool is “Crystals--&gt;Circle IDL found peaks” which applies an algorithm very similar to peakfinder8, and enables you to adjust peak finding values applied to the current image to maximise the accuracy of peak finding.  Move on to new images with forwards/back/random to make sure the recipe works for more than just one frame.  Tweak values according to intuition - there is unfortunately no substitute for using your brain and intelligence.  <br /></p>
                <p class="Free_Form"><br /></p>
                <p style="padding-bottom: 0pt; " class="Free_Form">Note that peaks found by Cheetah can be used for indexing by CrystFEL.  Reliably selecting peaks at the hit finding stage benefits both indexing rate as well as accurate hit finding. </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>


